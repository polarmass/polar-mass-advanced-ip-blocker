jQuery(document).ready(function(t){t('.pmip-register-cron input[type="submit"]').on("click",function(i){if(i.preventDefault(),confirm(pmipAdmin.i18n.confirmCron)){let n=t(this);n.prop("disabled",!0),t.post(pmipAdmin.ajaxUrl,{action:"pmip_register_cron",nonce:pmipAdmin.nonce}).done(i=>{alert(i.data.message||pmipAdmin.i18n.error),i.success?t(".pmip-register-cron").fadeTo(300,0).slideUp(300,function(){t(this).remove()}):n.prop("disabled",!1)}).fail(()=>{alert(pmipAdmin.i18n.error),n.prop("disabled",!1)})}}),t(".pmip-show-token-instructions").on("click",function(i){i.preventDefault(),t("#pmip-token-instructions").fadeIn(300),t("body").addClass("pmip-modal-open")}),t("#pmip-close").on("click",function(){t("#pmip-token-instructions").fadeOut(300),t("body").removeClass("pmip-modal-open")}),t("#pmip-token-instructions").on("click",function(i){t(i.target).is("#pmip-token-instructions")&&(t("#pmip-token-instructions").fadeOut(300),t("body").removeClass("pmip-modal-open"))}),t("#pmip-block-ip").on("click",function(){var i=t("#pmip-ip-input").val().trim();i?confirm(pmipAdmin.i18n.confirmBlock)&&t.ajax({url:pmipAdmin.ajaxUrl,type:"POST",data:{action:"pmip_block_ip",nonce:pmipAdmin.nonce,ip:i},beforeSend:function(){t("#pmip-block-ip").prop("disabled",!0)},success:function(i){i.success?(alert(i.data.message),t("#pmip-ip-input").val(""),location.reload()):alert(i.data.message||pmipAdmin.i18n.error)},error:function(){alert(pmipAdmin.i18n.error)},complete:function(){t("#pmip-block-ip").prop("disabled",!1)}}):alert(pmipAdmin.i18n.enterIp)}),t("#pmip-unblock-ip").on("click",function(){var i=t("#pmip-ip-input").val().trim();i?confirm(pmipAdmin.i18n.confirmUnblock)&&t.ajax({url:pmipAdmin.ajaxUrl,type:"POST",data:{action:"pmip_unblock_ip",nonce:pmipAdmin.nonce,ip:i},beforeSend:function(){t("#pmip-unblock-ip").prop("disabled",!0)},success:function(i){i.success?(alert(i.data.message),t("#pmip-ip-input").val(""),location.reload()):alert(i.data.message||pmipAdmin.i18n.error)},error:function(){alert(pmipAdmin.i18n.error)},complete:function(){t("#pmip-unblock-ip").prop("disabled",!1)}}):alert(pmipAdmin.i18n.enterIp)}),t("#pmip-log-level").on("change",function(){let i=t(this).val();(i?(t(".pmip-log-entries tr").hide(),t(".pmip-log-entries tr:first").show(),t(".pmip-log-entries tr").filter(function(){return t(this).find("td:eq(1)").text().toLowerCase()===i})):t(".pmip-log-entries tr")).show()}),t("#pmip-export-logs").on("click",function(){window.location.href=pmipAdmin.ajaxUrl+"?action=pmip_export_logs&nonce="+pmipAdmin.nonce}),t("#pmip-ip-input").on("input",function(){var i=t(this).val().trim();!i||/^(\d{1,3}\.){3}\d{1,3}$/.test(i)||/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(i)?t(this).removeClass("error"):t(this).addClass("error")}),t("#pmip-sync-wordfence").on("click",function(){confirm(pmipAdmin.i18n.confirmSync)&&t.ajax({url:pmipAdmin.ajaxUrl,type:"POST",data:{action:"pmip_sync_wordfence",nonce:pmipAdmin.nonce},beforeSend:function(){t("#pmip-sync-wordfence").prop("disabled",!0)},success:function(i){i.success?(alert(i.data.message),location.reload()):alert(i.data.message||pmipAdmin.i18n.error)},error:function(){alert(pmipAdmin.i18n.error)},complete:function(){t("#pmip-sync-wordfence").prop("disabled",!1)}})}),pmipAdmin.isSubscribed?(t(".pmip-newsletter-form").hide(),t(".pmip-newsletter").append('<div class="pmip-newsletter-success"><p>You are already subscribed!</p></div>')):t(".pmip-newsletter-form").on("submit",function(i){i.preventDefault();i=t(this).find('input[type="email"]').val();let n=t(".pmip-newsletter-message"),e=t(this).find("button"),p=t(this);t(".pmip-newsletter");t.ajax({url:"https://polarmass.com/wp-json/pmip/v1/newsletter/signup",type:"POST",contentType:"application/json",data:JSON.stringify({email:i}),beforeSend:function(){e.prop("disabled",!0),p.css("opacity","0.5")},success:function(i){i.success?(p.fadeOut(300,function(){var i=t('<div class="pmip-newsletter-success"><p>Thank you for subscribing to our newsletter!</p></div>').hide();t(this).after(i),i.fadeIn(300)}),t.ajax({url:pmipAdmin.ajaxUrl,type:"POST",data:{action:"pmip_update_newsletter_status",nonce:pmipAdmin.nonce}})):n.removeClass("success").addClass("error").text(i.data.message).fadeIn()},error:function(){n.removeClass("success").addClass("error").text(pmipAdmin.i18n.error).fadeIn()},complete:function(){e.prop("disabled",!1),p.css("opacity","1"),setTimeout(function(){n.fadeOut()},5e3)}})})});